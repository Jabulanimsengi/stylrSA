# ðŸš€ Deployment Guide: Cloudflare Pages Migration

This guide outlines the steps to deploy the **Stylr SA** frontend to Cloudflare Pages, replacing Vercel.

## 1. Prerequisites
- [x] **Cloudflare Account**: Ensure you have access to the Cloudflare Dashboard.
- [x] **Git Repository**: Your code must be pushed to GitHub/GitLab.
- [x] **Backend URL**: Your backend is running on Render (`https://stylrsa.onrender.com`).

## 2. Cloudflare Pages Setup

1.  Log in to the **Cloudflare Dashboard**.
2.  Go to **Compute (Workers & Pages)** > **Pages**.
3.  Click **Connect to Git**.
4.  Select your repository (`hairprosdirectory` or similar).

## 3. Build Configuration (CRITICAL)

Use the following **exact settings** to ensure OpenNext works correctly:

| Setting | Value |
| :--- | :--- |
| **Framework Preset** | `Next.js` |
| **Build Command** | `npm run build:cloudflare` |
| **Build Output Directory** | `.open-next/assets` |
| **Root Directory** | `frontend` |

> **âš ï¸ IMPORTANT**: Do NOT use `.next` as the output directory. OpenNext outputs to `.open-next/assets`.

## 4. Environment Variables

Add the following variables in **Settings > Environment variables** (Production & Preview):

| Variable | Value | Description |
| :--- | :--- | :--- |
| `NEXT_PUBLIC_SITE_URL` | `https://www.stylrsa.co.za` | Your custom domain |
| `NEXT_PUBLIC_API_URL` | `https://stylrsa.onrender.com` | **Must match your Render backend** |
| `NEXT_PUBLIC_API_ORIGIN` | `https://stylrsa.onrender.com` | For Auth/SSO |
| `NEXT_PUBLIC_CLOUDFLARE` | `true` | Flags app to use Edge-compatible logic |
| `NODE_VERSION` | `20` | Ensure Node.js 20+ is used for build |

## 5. Post-Deployment Verification

After the build completes (usually 2-3 minutes):

1.  **Check Homepage**: Ensure images load (Cloudinary) and content appears.
2.  **Check SEO Pages**: Visit a service page (e.g., `/braids/gauteng/johannesburg`).
    *   *Success*: Page loads with star ratings.
    *   *Failure*: 500 Error (indicates Prisma/Edge issue - but we fixed this!).
3.  **Check Auth**: Try logging in (uses `NEXT_PUBLIC_API_ORIGIN`).

## 6. Troubleshooting

- **500 Errors on SEO Pages**:
    - Check if `NEXT_PUBLIC_API_URL` is set correctly.
    - Ensure the Backend is running.
- **Images not loading**:
    - Check `next.config.ts` `images.remotePatterns` (we configured this).
- **Build Fails**:
    - Check logs. If "Prisma Client" error, ensure you are NOT importing `PrismaClient` in any client-side or edge-compatible file (we moved `aggregate-rating` to backend to solve this).

---
*Generated by Antigravity Agent*
