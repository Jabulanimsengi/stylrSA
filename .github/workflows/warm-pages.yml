name: Page Warming

on:
  # Run weekly on Sunday at 2 AM UTC (less frequent = lower ISR costs)
  schedule:
    - cron: '0 2 * * 0'
  
  # Allow manual trigger from GitHub UI
  workflow_dispatch:
    inputs:
      start_from:
        description: 'Start from page number'
        required: false
        default: '0'
      limit:
        description: 'Number of pages to warm'
        required: false
        default: '5000'
      concurrency:
        description: 'Concurrent requests'
        required: false
        default: '3'

jobs:
  # Single job: Warm critical pages only (5,000 highest-priority pages)
  warm-critical-pages:
    runs-on: ubuntu-latest
    timeout-minutes: 120  # 2 hour max (reduced from 6)
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Run Page Warming Script
        working-directory: frontend
        env:
          BASE_URL: https://www.stylrsa.co.za
        run: |
          echo "üî• Starting page warming (critical pages only)"
          echo "‚è∞ This workflow now runs weekly to reduce ISR costs"
          node scripts/warm-pages.js \
            --start-from ${{ github.event.inputs.start_from || '0' }} \
            --limit ${{ github.event.inputs.limit || '5000' }} \
            --concurrency ${{ github.event.inputs.concurrency || '3' }}
